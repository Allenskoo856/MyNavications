<!DOCTYPE html>
<html lang="zh">
@include("/common/_header.html"){}
<body class="page-body">
<script>
            $(document).ready(function(){
                toastr.options = {
                		  "closeButton": true,
                		  "debug": false,
                		  "positionClass": "toast-top-right",
                		  "showDuration": "15000",
                		  "hideDuration": "1000",
                		  "timeOut": "15000",
                		  "extendedTimeOut": "1000",
                		  "showEasing": "swing",
                		  "hideEasing": "linear",
                		  "showMethod": "fadeIn",
                		  "hideMethod": "fadeOut"
                		}
            });

        </script>     
	<!-- skin-white -->
	<div class="page-container">

		@include("/common/_sidebar.html"){}

		<div class="main-content">
			<nav class="navbar user-info-navbar" role="navigation">
				<!-- Left links for user info navbar -->
				<ul class="user-info-menu left-links list-inline list-unstyled">
					<li class="hidden-sm hidden-xs"><a href="#"
						data-toggle="sidebar"> <i class="fa-bars"></i>
					</a></li>
				</ul>

			</nav>



			<div id="search" class="s-search">
				<div id="search-list" class="hide-type-list">
					<div class="s-type">
						<span></span>
						<div class="s-type-list animated fadeInUp">
							<input hidden type="radio" name="search-type" id="type-baidu" value="common">
							<label for="type-baidu">常用</label> 
							<input hidden type="radio" name="search-type" id="type-search" value="search">
							<label for="type-search">搜索</label>
						</div>
					</div>
					<div class="search-group group-a">
						<span class="type-text">常用</span>
						<ul class="search-type">
							<li><input hidden type="radio" name="type" id="type-zhannei"
								value="/search/" data-placeholder="站内搜索"><label
								for="type-zhannei"><span style="color: #888888">站内</span></label></li>
						</ul>
					</div>
				</div>
				<form action="?s=" method="get" id="super-search-fm">
					<input type="text" id="search-text" placeholder="输入关键字搜索"
						style="outline: 0">
					<button type="submit">
						<i class="fa fa-search "></i>
					</button>
				</form>
				<div class="set-check hidden-xs">
					<input type="checkbox" id="set-search-blank" class="bubble-3"
						autocomplete="off">
				</div>
			</div>
			<script type="text/javascript">
    eval(function(e,t,a,c,i,n){if(i=function(e){return(e<t?"":i(parseInt(e/t)))+(35<(e%=t)?String.fromCharCode(e+29):e.toString(36))},!"".replace(/^/,String)){for(;a--;)n[i(a)]=c[a]||i(a);c=[function(e){return n[e]}],i=function(){return"\\w+"},a=1}for(;a--;)c[a]&&(e=e.replace(new RegExp("\\b"+i(a)+"\\b","g"),c[a]));return e}('!2(){2 g(){h(),i(),j(),k()}2 h(){d.9=s()}2 i(){z a=4.8(\'A[B="7"][5="\'+p()+\'"]\');a&&(a.9=!0,l(a))}2 j(){v(u())}2 k(){w(t())}2 l(a){P(z b=0;b<e.O;b++)e[b].I.1c("s-M");a.F.F.F.I.V("s-M")}2 m(a,b){E.H.S("L"+a,b)}2 n(a){6 E.H.Y("L"+a)}2 o(a){f=a.3,v(u()),w(a.3.5),m("7",a.3.5),c.K(),l(a.3)}2 p(){z b=n("7");6 b||a[0].5}2 q(a){m("J",a.3.9?1:-1),x(a.3.9)}2 r(a){6 a.11(),""==c.5?(c.K(),!1):(w(t()+c.5),x(s()),s()?E.U(b.G,+T X):13.Z=b.G,10 0)}2 s(){z a=n("J");6 a?1==a:!0}2 t(){6 4.8(\'A[B="7"]:9\').5}2 u(){6 4.8(\'A[B="7"]:9\').W("14-N")}2 v(a){c.1e("N",a)}2 w(a){b.G=a}2 x(a){a?b.3="1a":b.16("3")}z y,a=4.R(\'A[B="7"]\'),b=4.8("#18-C-19"),c=4.8("#C-12"),d=4.8("#17-C-15"),e=4.R(".C-1b"),f=a[0];P(g(),y=0;y<a.O;y++)a[y].D("Q",o);d.D("Q",q),b.D("1d",r)}();',62,77,"||function|target|document|value|return|type|querySelector|checked||||||||||||||||||||||||||var|input|name|search|addEventListener|window|parentNode|action|localStorage|classList|newWindow|focus|superSearch|current|placeholder|length|for|change|querySelectorAll|setItem|new|open|add|getAttribute|Date|getItem|href|void|preventDefault|text|location|data|blank|removeAttribute|set|super|fm|_blank|group|remove|submit|setAttribute".split("|"),0,{}));

</script>



			<!-- 搜索状态提示区域 -->
			<div id="search-status" class="search-status" style="display: none;">
				<div class="search-info">
					<span id="search-result-text"></span>
					<button id="clear-search" class="clear-search-btn">
						<i class="fa fa-times"></i> 清除搜索
					</button>
				</div>
			</div>

			<!-- 加载状态 -->
			<div id="loading" class="loading" style="display: none;">
				<div class="loading-content">
					<i class="fa fa-spinner fa-spin"></i>
					<span>搜索中...</span>
				</div>
			</div>

			<!-- 内容区域容器 -->
			<div id="content-container">
				@include("/common/_content.html"){}
			</div>

			<!-- Main Footer -->
			<!-- Choose between footer styles: "footer-type-1" or "footer-type-2" -->
			<!-- Add class "sticky" to  always stick the footer to the end of page (if page contents is small) -->
			<!-- Or class "fixed" to  always fix the footer to the end of page -->
			<footer class="main-footer sticky footer-type-1">
				<div class="footer-inner">
					<!-- Add your copyright text here -->
					<div class="footer-text">
						&copy; 2019 <a href="/">lizl13</a></a>
					</div>
					<div class="go-up">
						<a href="#" rel="go-top"> <i class="fa-angle-up"></i>
						</a>
					</div>
				</div>
			</footer>
		</div>
	</div>

	<!-- 回到顶部按钮 -->
	<button class="back-to-top" id="backToTop" type="button" title="回到顶部">
		<i class="fa fa-chevron-up"></i>
	</button>


	<script type="text/javascript">
	  $(function() {
		  $("img").lazyload({ threshold :180});
	  });
		
		// 优化的平滑滚动导航功能（合并重复事件处理）
		$(document).ready(function() {
			$("a.smooth").off('click').on('click', function(e) {
				e.preventDefault();
				e.stopPropagation(); // 防止事件冒泡
				
				// 更新活动状态
				$("#side-menu li").removeClass("active");
				$(this).closest("li").addClass("active");
				
				// 获取目标位置
				var target = $(this).attr("href");
				var $target = $(target);
				
				if ($target.length) {
					var targetTop = $target.offset().top - 30;
					
					// 优化的平滑滚动，缩短动画时间
					$("html, body").animate({
						scrollTop: targetTop
					}, {
						duration: 300, // 从500ms减少到300ms
						easing: "swing"
					});
				}
				
				return false;
			});
		});

		// Ajax搜索功能
		$(document).ready(function() {
			var searchForm = $('#super-search-fm');
			var searchInput = $('#search-text');
			var contentContainer = $('#content-container');
			var searchStatus = $('#search-status');
			var loading = $('#loading');
			var clearSearchBtn = $('#clear-search');
			var searchResultText = $('#search-result-text');
			
			var searchTimeout;
			var currentKeyword = '';
			var originalContent = contentContainer.html(); // 保存原始内容
			
			// 防抖搜索函数
			function debounceSearch(keyword) {
				clearTimeout(searchTimeout);
				searchTimeout = setTimeout(function() {
					performSearch(keyword);
				}, 300); // 300ms延迟
			}
			
			// 执行搜索
			function performSearch(keyword) {
				keyword = keyword ? keyword.trim() : '';
				currentKeyword = keyword;
				
				console.log('开始搜索，关键词:', keyword);
				
				// 显示加载状态
				showLoading();
				
				$.ajax({
					url: '/api/search',
					type: 'GET',
					data: { keyword: keyword },
					dataType: 'json',
					beforeSend: function() {
						console.log('发送搜索请求...');
					},
					success: function(response, textStatus, xhr) {
						console.log('搜索响应:', response);
						console.log('响应状态:', textStatus);
						hideLoading();
						
						if (response && response.success) {
							renderSearchResults(response.data, response.isSearch, response.message, keyword);
							updateURL(keyword);
						} else {
							showError(response ? response.message : '搜索失败');
						}
					},
					error: function(xhr, status, error) {
						console.error('搜索请求失败:');
						console.error('状态:', status);
						console.error('错误:', error);
						console.error('响应文本:', xhr.responseText);
						console.error('响应状态:', xhr.status);
						console.error('响应头:', xhr.getAllResponseHeaders());
						hideLoading();
						
						// 尝试解析错误信息
						var errorMessage = '网络错误，请稍后再试';
						if (xhr.status === 404) {
							errorMessage = '搜索接口不存在 (404)';
						} else if (xhr.status === 500) {
							errorMessage = '服务器内部错误 (500)';
						} else if (xhr.status === 403) {
							errorMessage = '没有访问权限 (403)';
						} else if (xhr.status === 302) {
							errorMessage = '需要登录 (被重定向到登录页面)';
						} else if (error === 'parsererror') {
							errorMessage = '返回数据格式错误: ' + (xhr.responseText ? xhr.responseText.substring(0, 200) : '无响应内容');
						} else if (status === 'timeout') {
							errorMessage = '请求超时';
						}
						
						showError(errorMessage);
					}
				});
			}
			
			// 渲染搜索结果
			function renderSearchResults(data, isSearch, message, keyword) {
				var html = '';
				
				if (data && data.length > 0) {
					data.forEach(function(category) {
						if (category.sites && category.sites.length > 0) {
							html += '<h4 class="text-gray"><i class="linecons-tag" style="margin-right: 7px;" id="' + category.title + '"></i>' + category.title + '</h4>';
							html += '<div class="row">';
							
							category.sites.forEach(function(site) {
								html += '<div class="col-sm-3">';
								html += '  <div class="xe-widget xe-conversations box2 label-info" onclick="window.open(\'' + site.url + '\', \'_blank\')" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="' + site.url + '">';
								html += '    <div class="xe-comment-entry">';
								html += '      <a class="xe-user-img">';
								html += '        <i class="fa fa-globe random-icon" style="font-size: 24px; color: #667eea; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border-radius: 50%; border: 2px solid #e9ecef;"></i>';
								html += '      </a>';
								html += '      <div class="xe-comment">';
								html += '        <a href="#" class="xe-user-name overflowClip_1">';
								html += '          <strong>' + site.title + '</strong>';
								html += '        </a>';
								html += '        <p class="overflowClip_2">' + site.description + '</p>';
								html += '      </div>';
								html += '    </div>';
								html += '  </div>';
								html += '</div>';
							});
							
							html += '</div><br>';
						}
					});
				} else if (isSearch && keyword) {
					// 显示空搜索结果
					html = '<div class="no-results">';
					html += '  <i class="fa fa-search"></i>';
					html += '  <h3>未找到相关结果</h3>';
					html += '  <p>请尝试使用不同的关键词进行搜索</p>';
					html += '</div>';
				}
				
				// 更新内容区域
				contentContainer.html(html);
				
				// 重新初始化随机图标
				initRandomIcons();
				
				// 显示或隐藏搜索状态
				if (isSearch && keyword) {
					searchResultText.text(message);
					searchStatus.show();
				} else {
					searchStatus.hide();
				}
			}
			
			// 初始化随机图标
			function initRandomIcons() {
				var icons = [
					'fa-globe', 'fa-desktop', 'fa-mobile', 'fa-laptop', 'fa-tablet',
					'fa-code', 'fa-cogs', 'fa-database', 'fa-server', 'fa-cloud',
					'fa-rocket', 'fa-star', 'fa-heart', 'fa-gem', 'fa-shield',
					'fa-bookmark', 'fa-tag', 'fa-flag', 'fa-home', 'fa-building',
					'fa-graduation-cap', 'fa-book', 'fa-newspaper-o', 'fa-camera', 'fa-music',
					'fa-gamepad', 'fa-shopping-cart', 'fa-credit-card', 'fa-chart-bar', 'fa-pie-chart',
					'fa-paint-brush', 'fa-palette', 'fa-image', 'fa-video-camera', 'fa-microphone',
					'fa-headphones', 'fa-wifi', 'fa-bluetooth', 'fa-rss', 'fa-share-alt'
				];
				
				$('.random-icon').each(function() {
					var randomIndex = Math.floor(Math.random() * icons.length);
					var randomIcon = icons[randomIndex];
					$(this).removeClass('fa-globe').addClass(randomIcon);
				});
			}
			
			// 显示加载状态
			function showLoading() {
				loading.show();
				contentContainer.hide();
			}
			
			// 隐藏加载状态
			function hideLoading() {
				loading.hide();
				contentContainer.show();
			}
			
			// 显示错误信息
			function showError(message) {
				var errorHtml = '<div class="no-results">';
				errorHtml += '  <i class="fa fa-exclamation-triangle"></i>';
				errorHtml += '  <h3>搜索出错</h3>';
				errorHtml += '  <p>' + message + '</p>';
				errorHtml += '</div>';
				contentContainer.html(errorHtml);
			}
			
			// 更新URL
			function updateURL(keyword) {
				if (keyword) {
					history.pushState({keyword: keyword}, '', '/search/' + encodeURIComponent(keyword));
				} else {
					history.pushState({}, '', '/');
				}
			}
			
			// 表单提交事件
			searchForm.on('submit', function(e) {
				e.preventDefault();
				var keyword = searchInput.val().trim();
				performSearch(keyword);
			});
			
			// 实时搜索（可选）
			searchInput.on('input', function() {
				var keyword = $(this).val().trim();
				if (keyword.length >= 2 || keyword.length === 0) {
					debounceSearch(keyword);
				}
			});
			
			// 清除搜索按钮事件
			clearSearchBtn.on('click', function() {
				searchInput.val('');
				contentContainer.html(originalContent);
				searchStatus.hide();
				currentKeyword = '';
				updateURL('');
				initRandomIcons(); // 重新初始化图标
			});
			
			// 测试API连接(仅在开发环境使用)
			if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
				console.log('正在测试API连接...');
				$.get('/api/test').done(function(data) {
					console.log('API测试成功:', data);
				}).fail(function(xhr) {
					console.error('API测试失败:', xhr.status, xhr.responseText);
				});
			}
							
			// 处理浏览器后退/前进
			window.addEventListener('popstate', function(e) {
				if (e.state && e.state.keyword) {
					searchInput.val(e.state.keyword);
					performSearch(e.state.keyword);
				} else {
					searchInput.val('');
					contentContainer.html(originalContent);
					searchStatus.hide();
					initRandomIcons();
				}
			});
		});

		// 回到顶部按钮功能
		var backToTopButton = $('#backToTop');
		
		// 监听页面滚动
		$(window).scroll(function() {
			if ($(this).scrollTop() > 300) {
				backToTopButton.addClass('visible');
			} else {
				backToTopButton.removeClass('visible');
			}
		});
		
		// 点击回到顶部
		backToTopButton.click(function() {
			$('html, body').animate({
				scrollTop: 0
			}, {
				duration: 400, // 略微减少回到顶部的动画时间
				easing: 'swing'
			});
			return false;
		});
	</script>
</body>

</html>